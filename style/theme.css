.tabs-content {
  border-color: var(--border) !important;
}
/* 主题变量与覆盖（轻量接管现有硬编码颜色）
   使用方法：在 <html> 上设置 data-theme="dark" 以启用深色；不设置为浅色默认。
*/

/* 色板变量：浅色默认 */
:root {
  /* 基础 */
  --bg-start: #edf2f7; /* 页面背景渐变起点 */
  --bg-end:   #f7fafc; /* 页面背景渐变终点 */
  --surface:  #ffffff; /* 卡片/面板背景 */
  --surface-soft: rgba(255,255,255,0.95);
  --border:   #e2e8f0; /* 分隔/边框 */
  --shadow-1: rgba(0,0,0,0.08);
  --shadow-2: rgba(0,0,0,0.12);

  /* 文本 */
  --text:        #2d3748; /* 主文本 */
  --text-muted:  #4a5568; /* 次文本 */
  --text-subtle: #a0aec0; /* 占位/提示 */

  /* 主色/语义色 */
  --primary-1: #8698ff;
  --primary-2: #7084ff;
  --primary-3: #5a6cff;
  --primary-ring: rgba(66,153,225,0.20);
  --primary-shadow: rgba(134, 152, 255, 0.25);

  --success:       #48bb78;
  --success-hover: #38a169;

  --danger:        #f56565;
  --danger-hover:  #e53e3e;

  /* 组件专用（tokens、toast 等） */
  --token-odd-bg:  #F7FAFC;
  --token-even-bg: #FFFFFF;
  --token-accent-blue: #BEE3F8;
  --token-accent-green:#C6F6D5;

  --panel-header-bg: #F7FAFC;
  --log-bg: #fff;
  --log-header-bg: #F8FAFC;
  --log-border: #e2e8f0;

  --toast-ok-bg:   #F0FFF4; --toast-ok-border:#9AE6B4; --toast-ok-text:#22543D;
  --toast-err-bg:  #FEF2F2; --toast-err-border:#FCA5A5; --toast-err-text:#7F1D1D; --toast-err-icon:#B91C1C;
  
  /* 自定义：代词颜色（浅色主题下稍暗的红） */
  --pronoun-color: #d60000bb;
}

/* 深色主题变量 */
html[data-theme="dark"] {
  --bg-start: #0f172a; /* slate-900-ish */
  --bg-end:   #111827; /* gray-900 */
  --surface:  #0b1220; /* 近黑蓝，提升对比 */
  --surface-soft: rgba(17,24,39,0.9);
  --border:   rgba(148,163,184,0.18); /* slate-400 @ 18% */
  --shadow-1: rgba(0,0,0,0.35);
  --shadow-2: rgba(0,0,0,0.5);

  --text:        #e5e7eb; /* gray-200 */
  --text-muted:  #cbd5e1; /* slate-300 */
  --text-subtle: #94a3b8; /* slate-400 */

  --primary-1: #5b6cff; /* indigo-500 近似 */
  --primary-2: #4f46e5; /* indigo-600 */
  --primary-3: #4338ca; /* indigo-700 */
  --primary-ring: rgba(99,102,241,0.28); /* indigo-500 ring */
  --primary-shadow: rgba(99,102,241,0.30);

  --success:       #16a34a; /* green-600 */
  --success-hover: #15803d; /* green-700 */

  --danger:        #ef4444; /* red-500 */
  --danger-hover:  #dc2626; /* red-600 */

  --token-odd-bg:  rgba(148,163,184,0.08); /* 淡石板 */
  --token-even-bg: rgba(148,163,184,0.04);
  --token-accent-blue: rgba(56,189,248,0.55);
  --token-accent-green:rgba(74,222,128,0.55);

  --panel-header-bg: rgba(148,163,184,0.08);
  --log-bg: #0f172a;
  --log-header-bg: rgba(148,163,184,0.10);
  --log-border: rgba(148,163,184,0.18);

  --toast-ok-bg:   rgba(34,197,94,0.12);
  --toast-ok-border:rgba(34,197,94,0.35);
  --toast-ok-text: #bbf7d0;
  --toast-err-bg:   rgba(239,68,68,0.12);
  --toast-err-border:rgba(239,68,68,0.35);
  --toast-err-text: #fecaca;
  --toast-err-icon: #fca5a5;

  /* 自定义：代词颜色（深色主题下提升亮度与对比） */
  --pronoun-color: #ff6b6b; /* 可视性更好，亦可根据需要调整为 #ff4d4f 等 */

  /* 让浏览器内置控件（输入框、滚动条、内置图标等）采用深色外观 */
  color-scheme: dark;
}

/* 全局背景与文字 */
html, body { color: var(--text); }
/* 让 html/body 覆盖满屏，避免短页面时出现“页面下方另一块底色” */
html, body { min-height: 100vh; }
/* 同步 html 与 body 的背景，避免某些浏览器在 body 不满屏时显示不同底色 */
html { background: linear-gradient(135deg, var(--bg-start) 0%, var(--bg-end) 100%) !important; }
body { background: inherit !important; }

/* 主题切换时的轻量过渡（全页淡入），避免对每个节点颜色/背景做昂贵过渡 */
html.theme-switching body {
  transition: opacity 180ms ease;
  opacity: 0.96;
}

/* 
   性能优化：在主题切换期间禁用所有元素的过渡动画。
   这是为了配合 JavaScript 中的 View Transitions API（如果支持）或作为降级方案。
   如果浏览器支持 View Transitions，屏幕会进行全页交叉淡入淡出，非常流畅且无需逐个元素计算。
   如果不支持，则通过 body 透明度变化提供简单的视觉反馈，避免卡顿。
*/
html.theme-switching *,
html.theme-switching *::before,
html.theme-switching *::after {
  transition: none !important;
}

/* 面板/模态通用覆盖（登录也使用 .panel） */
.panel, #login-container {
  background: var(--surface-soft) !important;
  border: 1px solid var(--border) !important;
  box-shadow: 0 8px 32px var(--shadow-2), 0 4px 16px var(--shadow-1) !important;
}
.modal {
  background: var(--surface-soft) !important;
  border: 1px solid var(--border) !important;
  box-shadow: 0 20px 25px -5px var(--shadow-2), 0 10px 10px -5px var(--shadow-1) !important;
  color: var(--text) !important;
}
.modal-header { border-bottom-color: var(--border) !important; }
.modal-header h2 { color: var(--text) !important; }
.modal-message { color: var(--text-muted) !important; }
.modal-message.success {
  color: var(--success) !important;
  background: color-mix(in srgb, var(--success) 10%, transparent) !important;
  border: 1px solid color-mix(in srgb, var(--success) 40%, transparent) !important;
}
.modal-message.error {
  color: var(--danger) !important;
  background: color-mix(in srgb, var(--danger) 10%, transparent) !important;
  border: 1px solid color-mix(in srgb, var(--danger) 40%, transparent) !important;
}

/* 表单控件 */
.modal-form input,
#login-form input,
#panel_tokens .tokens-input,
#panel_permissions .tokens-input {
  border: 1px solid var(--border) !important;
  background: transparent !important;
  color: var(--text) !important;
  transition: all 0.2s ease;
}

.modal-form input:hover,
#login-form input:hover,
#panel_tokens .tokens-input:hover,
#panel_permissions .tokens-input:hover {
  background: color-mix(in srgb, var(--surface) 96%, transparent) !important;
  border-color: var(--text-muted) !important;
}

.modal-form input::placeholder,
#panel_tokens .tokens-input::placeholder,
#panel_permissions .tokens-input::placeholder { color: var(--text-subtle) !important; opacity: 0.8; }

.modal-form input:focus,
#panel_tokens .tokens-input:focus,
#panel_permissions .tokens-input:focus {
  border-color: var(--primary-2) !important;
  box-shadow: 0 0 0 3px var(--primary-ring) !important;
  background: var(--surface) !important;
}

/* Tokens 工具栏按钮与输入框边框颜色一致 */
#panel_tokens .tokens-btn,
#panel_permissions .tokens-btn { border-color: var(--border) !important; }
#panel_tokens #tokens-compact-toggle { border-color: var(--border) !important; }

/* 按钮系统 */
.btn { color: var(--text) }
.btn--primary {
  background: linear-gradient(135deg, var(--primary-1) 0%, var(--primary-2) 50%, var(--primary-3) 100%) !important;
  background-size: 200% 200% !important;
  background-position: 0% 50% !important;
  color: #ffffff !important;
  border: none !important;
  box-shadow: 0 4px 6px -1px var(--primary-shadow) !important;
}
.btn--primary:hover { background-position: 100% 50% !important; }
.btn--secondary {
  background: transparent !important;
  color: color-mix(in srgb, var(--text) 86%, var(--bg-end)) !important;
  border-color: var(--border) !important;
}
.btn--secondary:hover {
  background: color-mix(in srgb, var(--surface) 92%, transparent) !important;
  border-color: color-mix(in srgb, var(--border) 80%, transparent) !important;
  color: var(--primary-2) !important;
}
.btn--success { background: var(--success) !important; color: #fff !important; border: none !important; }
.btn--success:hover { background: var(--success-hover) !important; }
.btn--danger { background: var(--danger) !important; color: #fff !important; border: none !important; }
.btn--danger:hover { background: var(--danger-hover) !important; }
.btn:disabled {
  background: color-mix(in srgb, var(--border) 70%, transparent) !important;
  color: var(--text-subtle) !important;
  border-color: var(--border) !important;
  box-shadow: none !important;
}

/* 顶部 Header 与导航 */
#header {
  background: linear-gradient(135deg, var(--surface) 0%, color-mix(in srgb, var(--surface) 92%, transparent) 100%) !important;
  border-bottom: 1px solid var(--border) !important;
  box-shadow: 0 2px 8px var(--shadow-1), 0 4px 16px color-mix(in srgb, var(--shadow-1) 50%, transparent) !important;
}
#title-a { color: var(--text) !important; }
#title-a::after { background: var(--text) !important; }
#sidebar { background: inherit !important; }
#header-avatar { border-color: var(--border) !important; background: var(--surface) !important; box-shadow: 0 2px 8px var(--shadow-1) !important; }



.sidebar-menu_button:hover {
  background: color-mix(in srgb, var(--text) 8%, transparent) !important;
  color: var(--text) !important;
}
#logout-button:hover {
  background: color-mix(in srgb, var(--danger) 10%, transparent) !important;
  color: color-mix(in srgb, var(--danger) 80%, white) !important;
}
/* 侧边栏通用按钮轻度悬浮反馈（主题自适应）*/
.sidebar-menu_button { color: var(--text) !important; }
.sidebar-menu_button:hover { background: color-mix(in srgb, var(--text) 8%, transparent) !important; }

/* Tokens 页：容器与卡片/分区 */
#tokens-summary .type-tile {
  border-color: var(--border) !important;
  background: color-mix(in srgb, var(--surface) 92%, transparent);
}
#tokens-summary .type-tile__label { color: var(--text-muted) !important; }
#tokens-summary .type-tile__value { color: var(--text) !important; }

.tabs.nav[data-tabs],
#example-tabs {
  /* Foundation tabs 容器继承 Header 背景 */
  background: inherit !important;
}
/* 避免短页面时 tabs 区域底部出现一条边框线 */
.tabs-content { border-bottom: none !important; }

.tokens-section { border-color: var(--border) !important; background: var(--surface) !important; }
.tokens-section__header { background: var(--panel-header-bg) !important; border-bottom: 1px solid var(--border) !important; }
.tokens-section__title { color: var(--text) !important; }
.tokens-empty { color: var(--text-subtle) !important; }

#termContainer {
  background: var(--surface) !important;
  color: var(--text) !important;
}

/* 将池（panel_character）搜索框主题适配 */
#panel_character #search-input {
  background-color: var(--surface) !important; /* 覆盖内联白底 */
  color: var(--text) !important;
  border: 1px solid var(--border) !important;
  border-radius: 6px !important;
}
#panel_character #search-input::placeholder { color: var(--text-subtle) !important; }
#panel_character #search-input:focus { border-color: color-mix(in srgb, var(--text-subtle) 60%, transparent) !important; }

/* 技能（panel_skill）搜索框主题适配（与将池一致） */
#panel_skill #search-input {
  background-color: var(--surface) !important;
  color: var(--text) !important;
  border: 1px solid var(--border) !important;
  border-radius: 6px !important;
}
#panel_skill #search-input::placeholder { color: var(--text-subtle) !important; }
#panel_skill #search-input:focus { border-color: color-mix(in srgb, var(--text-subtle) 60%, transparent) !important; }

/* 面板内临时白底块统一随主题 */
#panel_character #div4 { background-color: var(--surface) !important; }

/* 草稿面板：继承父级色彩，并对输入框做主题化 */
#panel_draft,
#panel_draft * {
  color: inherit;
}
#panel_draft .draftBlock { background: inherit !important; }
#panel_draft #htmlInput {
  background: color-mix(in srgb, var(--surface) 92%, transparent) !important;
  color: var(--text) !important;
  border: 1px solid var(--border) !important;
  border-radius: 6px;
}
#panel_draft #htmlInput::placeholder { color: var(--text-subtle) !important; }
#panel_draft #htmlInput:focus {
  border-color: color-mix(in srgb, var(--text-subtle) 60%, transparent) !important;
  box-shadow: 0 0 0 3px var(--primary-ring) !important;
  background: var(--surface) !important;
}

#tokens-content .token-card {
  background: var(--token-bg, var(--surface)) !important;
  border: 1px solid var(--border) !important;
  border-left-color: var(--token-accent, var(--border)) !important;
}
#tokens-content .token-list > .token-card:nth-child(odd) {
  --token-bg: var(--token-odd-bg);
  --token-accent: var(--token-accent-blue);
}
#tokens-content .token-list > .token-card:nth-child(even) {
  --token-bg: var(--token-even-bg);
  --token-accent: var(--token-accent-green);
}

#tokens-content .kv-row { border-bottom-color: var(--border) !important; }
#tokens-content .kv-key { color: var(--text-muted) !important; }
#tokens-content .kv-val { color: var(--text) !important; }
#tokens-content .kv-val:not(.is-editing):hover { background: color-mix(in srgb, var(--border) 30%, transparent) !important; }
#tokens-content .kv-val.is-editing { background: color-mix(in srgb, var(--surface) 92%, transparent) !important; box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--border) 80%, transparent) !important; }

.tokens-log { background: var(--log-bg) !important; border-color: var(--log-border) !important; }
.tokens-log__header { background: var(--log-header-bg) !important; border-bottom-color: var(--log-border) !important; }
.tokens-log__title, .tokens-log .log-row, .tokens-log .log-val { color: var(--text) !important; }
.tokens-log .log-time, .tokens-log .log-ctx { color: var(--text-subtle) !important; }
.tokens-log code.log-code { background: var(--panel-header-bg) !important; border-color: var(--border) !important; color: var(--text) !important; }

/* Tokens 主面板占满可视高度，避免底部露出背景色差 */
:root { --header-height: 64px; }
#panel_tokens { min-height: calc(100vh - var(--header-height)); background: var(--surface) !important; }
#panel_permissions { min-height: calc(100vh - var(--header-height)); background: var(--surface) !important; }

/* Toast 样式 */
.tokens-toast { background: var(--toast-ok-bg) !important; border-color: var(--toast-ok-border) !important; color: var(--toast-ok-text) !important; }
.tokens-toast.tokens-toast--error { background: var(--toast-err-bg) !important; border-color: var(--toast-err-border) !important; color: var(--toast-err-text) !important; }
.tokens-toast.tokens-toast--error > svg { color: var(--toast-err-icon) !important; }

/* 审核窗口列表项（暗色/浅色自适应） */
.approval-row {
  display: flex; align-items: center; justify-content: space-between; gap: 12px;
  padding: 12px; margin-bottom: 10px;
  border: 1px solid var(--border) !important;
  border-radius: 6px; background: color-mix(in srgb, var(--surface) 92%, transparent) !important;
}
.approval-left { display: flex; align-items: center; gap: 10px; }
.approval-img { width: 48px; height: 48px; border-radius: 50%; object-fit: cover; border: 1px solid var(--border) !important; background: var(--surface) !important; }
.approval-title { font-weight: 600; color: var(--text) !important; }
.approval-sub { font-size: 12px; color: var(--text-subtle) !important; }
.approval-right { display: flex; gap: 8px; }

/* 空列表提示（遵循主题色） */
.empty-hint { text-align: center; color: var(--text-subtle) !important; padding: 20px; }
.empty-hint.error { color: var(--danger) !important; }

/* 计数徽标：背景继承父元素 */
.count-badge { background: inherit !important; }

/* 将池：深色模式下提高武将图标水印可见度 */
html[data-theme="dark"] .container:hover .role_icon.dominator,
html[data-theme="dark"] .container:hover .role_icon.not_dominator {
  opacity: 0.06 !important; /* 由 0.025 提升，避免在深色底上消失 */
}

/* 使用 mask 渲染的武将图标：颜色随主题文字色变化 */
.role_icon--mask { background-color: var(--text) !important; }

/* 名片页权限徽标暗色适配（深红系） */
html[data-theme="dark"] .badge.badge-permission {
  color: #ffe5e5 !important; /* 更亮的浅红文字以提升对比 */
  background: #450a0a !important; /* 更深的红底 */
  border-color: #7f1d1d !important; /* 与浅色系一致的深红边框 */
}

/* 权限面板：标签与行内编辑器 */
#panel_permissions .perm-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
  margin-top: 6px;
}
#panel_permissions .perm-tag {
  display: inline-flex; align-items: center;
  padding: 2px 8px; border-radius: 999px;
  font-size: 12px; line-height: 1;
  background: color-mix(in srgb, var(--surface) 92%, transparent);
  border: 1px solid var(--border);
  color: var(--text);
}
#panel_permissions .perm-tag--more {
  color: var(--primary-2);
  background: color-mix(in srgb, var(--primary-2) 8%, transparent);
  border-color: color-mix(in srgb, var(--primary-2) 35%, var(--border));
}

#panel_permissions .perm-editor {
  margin-top: 8px;
  padding: 12px;
  border: 1px solid var(--border);
  border-radius: 8px;
  background: color-mix(in srgb, var(--surface) 96%, transparent);
  box-shadow: 0 4px 12px -6px var(--shadow-1);
}
#panel_permissions .perm-editor__toolbar {
  display: flex; gap: 8px; align-items: center; margin-bottom: 10px; flex-wrap: nowrap;
}
#panel_permissions .perm-editor__toolbar .btn { white-space: nowrap; flex: 0 0 auto; }

#panel_permissions .perm-editor__list {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
  gap: 8px; max-height: 220px; overflow: auto; padding-right: 4px;
}
#panel_permissions .perm-editor__item {
  display: flex; align-items: center; gap: 8px;
  padding: 6px 8px; border: 1px solid var(--border); border-radius: 6px;
  background: color-mix(in srgb, var(--surface) 92%, transparent);
}
#panel_permissions .perm-editor__item input { margin: 0; }
#panel_permissions .perm-editor__item-text { color: var(--text); font-size: 13px; }

#panel_permissions .perm-editor__actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 10px; }

/* 小按钮加载态（可选视觉提示） */
#panel_permissions .btn.is-loading { opacity: 0.7; pointer-events: none; }
