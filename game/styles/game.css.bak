/* Term Click Styling */
.term-click,
.crumb span[data-term] {
    cursor: pointer;
    font-weight: 600;
    transition: color 0.2s ease;
    /* 
       Global Default: Inherit color from container.
       This ensures terms in logs/card descriptions match the text color 
       (e.g., black/white) unless overridden by a specific parent like Breadcrumbs.
    */
    color: inherit; 
    position: relative;
    padding: 0 1px;
    border-radius: 3px;
    display: inline-block;
}

/* Game Panel Container */
#panel_game {
    padding: 15px;
    background-color: var(--bg-start);
    /* Further reduced height to ensure it clears the fixed footer completely */
    /* 100vh - Header(~60) - Footer(~40) - Safety Buffer(~60) = ~160px */
    height: calc(100vh - 160px) !important; 
    box-sizing: border-box;
    overflow: hidden !important; 
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: var(--text);
    /* Note: Display is handled by tabs system, overridden below for active state */
}

/* Ensure flex layout is only applied when tab is active */
#panel_game.is-active {
    display: flex !important;
    flex-direction: column;
}

.game-container {
    display: flex;
    flex-direction: column; /* Vertical stack */
    flex: 1; /* Turn into flex child filling parent */
    gap: 15px;
    width: 100%; /* Occupy full width */
    max-width: none; /* Remove width restriction */
    margin: 0; 
    min-height: 0; /* Critical for scroll inside flex */
}

.game-top-section {
    display: flex;
    flex-direction: row;
    /* Use stretch to ensure children (.game-layout-main) fill the full height */
    align-items: stretch;
    gap: 20px;
    width: 100%;
    /* Flex grow to push bottom section down */
    flex: 1 1 auto; 
    min-height: 0; /* Enable internal scrolling */
    overflow-y: auto; /* Scrollbar appears here */
    overflow-x: hidden;
    padding-right: 5px; /* Scrollbar spacing */
    padding-bottom: 10px;
}

.game-layout-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 20px;
    min-width: 0;
}

.game-layout-sidebar {
    width: 280px;
    flex-shrink: 0;
    display: flex;
    flex-direction: column;
    gap: 20px;
}

/* New Independent Panels */
.game-panel {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 4px var(--shadow-1);
    transition: background-color 0.3s ease;
}

.game-log-panel {
    min-height: 100px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.game-action-panel {
    display: flex;
    justify-content: center;
    padding: 15px;
    /* Remove contrast borders for seamless look */
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
}

/* Custom Scrollbar for Webkit */
.game-log-panel::-webkit-scrollbar {
    width: 6px;
}
.game-log-panel::-webkit-scrollbar-track {
    background: transparent;
}
.game-log-panel::-webkit-scrollbar-thumb {
    background-color: var(--border);
    border-radius: 3px;
}

.breadcrumbs {
    display: flex;
    flex-direction: column; /* Vertical layout */
    align-items: flex-start;
    font-size: 1rem; /* Unified size */
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
    gap: 4px;
    flex: 1; /* Take remaining space */
    min-width: 0; /* Allow shrinking if needed */
}

#game-controls {
    display: flex;
    flex-direction: row; /* Horizontal buttons in the new panel */
    gap: 20px;
    justify-content: center;
    width: 100%;
}

#game-controls .btn {
    min-width: 140px; /* Preserve layout width */
}

.breadcrumbs .crumb {
    display: inline-flex;
    align-items: center;
    opacity: 0;
    animation: slideInUp 0.3s forwards; /* Slower animation for visibility */
    font-size: 1rem; /* Ensure consistent size */
    transition: all 0.3s ease; /* Smooth transition for color, shadow, opacity */
}

.breadcrumbs .crumb:last-child {
    color: var(--primary);
}

@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(1px); /* Minimal movement */
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.timing-badge {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--text);
    padding: 6px 16px;
    background: var(--bg-panel);
    border-radius: 20px; /* Pill shape */
    border: 1px solid transparent; /* Ensure consistent box model */
    transition: all 0.3s ease;
    display: flex; /* Changed to flex to fill container in column layout */
    align-items: center;
    justify-content: center;
    letter-spacing: 0.02em;
    line-height: 1.4;
    min-height: 44px; /* Slightly increased to account for borders */
    white-space: nowrap; /* Prevent text wrapping */
    flex-shrink: 0; /* Prevent badge from shrinking */
    margin-left: 0; /* Removed margin-left as it is now stacked */
    width: 100%; /* Take full width when stacked */
    box-sizing: border-box;
}

.timing-badge:empty::before {
    content: "\00a0"; /* Non-breaking space to maintain height when empty */
    visibility: hidden;
}

.timing-badge .term-click {
    border-bottom: none; /* Remove underline inside badge to keep height consistent */
}

/* Main Game Area (Main Perspective) */
.game-main-area {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
}

.main-perspective-container {
    display: flex;
    min-width: 0; /* Constraint for flex container */
    gap: 20px;
    align-items: flex-start;
}

/* Current Character Panel */
.current-character-panel {
    flex: 3;
    min-width: 0; /* Constraint for flex child to allow shrinking */
    background: var(--surface);
    border-radius: 12px;
    padding: 25px;
    box-shadow: 0 4px 12px var(--shadow-1);
    border: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.character-info {
    display: flex;
    align-items: center;
    gap: 20px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
}

.char-avatar {
    position: relative;
    width: 100px;
    height: 100px;
    flex-shrink: 0;
    border-radius: 50%;
    box-shadow: 0 2px 4px var(--shadow-2);
}

.char-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 50%;
    /* Removed border: 4px solid var(--surface); as per user request */
}

/* Invert colors and add transparency for position-based avatars (symbols) in dark mode */
html[data-theme="dark"] .char-avatar img.position-avatar {
    filter: invert(1);
    opacity: 0.8;
}

.char-details {
    flex-grow: 1;
}

.char-details h3 {
    margin: 0 0 10px 0;
    color: var(--text);
    font-size: 1.4rem;
}

.char-stats {
    display: flex;
    gap: 4px; /* Reduced gap to match summary */
    align-items: center; /* Vertical alignment */
}

/* Ensure consistent sizing with role summary */
.char-stats .player-seat,
.char-stats .player-hand-count {
   /* Reuse styles from role_summary.css via classes, 
      but ensure specific overrides if needed */
   height: fit-content;
}

.char-stats .stat-hp,
.stat-hp {
    /* Modern Glassmorphism Red */
    background-color: rgba(245, 101, 101, 0.15); /* Tinted red */
    color: var(--danger, #f56565);
    border: 1px solid rgba(245, 101, 101, 0.3);
    
    /* Layout & Shape */
    padding: 2px 8px;
    border-radius: 12px;
    min-width: 32px;
    height: fit-content;
    
    /* Typography */
    font-weight: 700;
    font-size: 0.85rem;
    font-variant-numeric: tabular-nums;
    letter-spacing: 0.5px;
    
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 4px;
    
    /* Effects */
    backdrop-filter: blur(6px);
    -webkit-backdrop-filter: blur(6px);
    box-shadow: 0 2px 4px var(--shadow-1, rgba(0,0,0,0.1));
    
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}



@keyframes hp-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.2); background-color: rgba(245, 101, 101, 0.3); box-shadow: 0 0 15px rgba(245, 101, 101, 0.4); }
    100% { transform: scale(1); }
}

.stat-hp.hp-changed {
    animation: hp-pulse 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* Hand Cards Area */
.player-hand h4 {
    margin-top: 0;
    margin-bottom: 15px;
    color: var(--text-muted);
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Unified Card Area Style */
.cards-container, 
.treatment-container,
.player-hand .cards-container,
.game-card-area {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
    min-height: 174px; /* Locked height */
    width: 100%;
    box-sizing: border-box;
    padding: 15px;
    background-color: rgba(128, 128, 128, 0.05); /* Subtle variable-neutral tint */
    border-radius: 8px;
    border: 2px dashed var(--border);
    /* Update transition to include properties modified by drag-over state */
    transition: background-color 0.2s, border-color 0.2s, transform 0.2s, box-shadow 0.2s;
    /* Ensure transform-origin is stable */
    transform-origin: center center;
}

/* Alignment Utilities */
.area-centered {
    justify-content: center !important;
}
.area-left {
    justify-content: flex-start !important;
}

/* Stacking Utilities */
.area-stacked {
    /* 堆叠模式：默认单张显示 */
    display: block !important; 
    height: 100% !important; /* Fill the slot */
    min-height: 174px;
    padding: 0 !important; /* Force remove padding to fit single card exactly */
    overflow: hidden;
    position: relative; /* Anchor for absolute hover */
    transition: box-shadow 0.2s, background-color 0.2s;
}

/* 默认只显示顶牌（DOM中的最后一个子元素） */
.area-stacked > .card-placeholder {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    margin: 0 !important;
    display: none; /* Hide all by default */
    z-index: 1;
}

.area-stacked > .card-placeholder.is-top-card {
    display: flex; /* Show only top card */
    box-shadow: 2px 2px 0 #bbb, 4px 4px 0 #999, 0 2px 5px var(--shadow-1);
}

/* =========================================
   Deck Slot Style (No-Container Look)
   ========================================= */
.deck-slot {
    background: transparent !important;
    border: none !important;
    box-shadow: none !important;
}

/* Depth Effect for Cards in Deck Slot */
.deck-slot.area-stacked > .card-placeholder.is-top-card {
    /* Richer stack shadow */
    box-shadow: 
        1px 1px 0 #888,
        2px 2px 0 #ddd,
        3px 3px 0 #888,
        4px 4px 0 #ddd,
        5px 5px 0 #888,
        0 8px 15px rgba(0,0,0,0.4);
}

/* Empty State Placeholder */
.deck-slot:empty::after {
    content: 'EMPTY';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 60px;
    height: 80px;
    border: 2px dashed var(--border);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    font-size: 0.7rem;
    font-weight: 600;
    opacity: 0.3;
    pointer-events: none;
}

/* =========================================
   Pile Inspector (Fan/Roulette View)
   ========================================= */

/* 2. The Inspector Container */
.pile-inspector-overlay {
    position: absolute;
    /* Position above the pile */
    bottom: 110%; 
    left: 50%;
    transform: translateX(-50%);
    width: 300px; /* Width of the view window */
    height: 160px; /* Height for cards */
    
    /* Transparent container, no background */
    pointer-events: auto; /* Allow interaction to keep parent :hover active */
    
    display: none; /* Hidden by default */
    perspective: 1000px; /* 3D perspective for fan effect */
}

/* Show when container is hovered (handled by JS toggling class or direct CSS) */
/* Best to handle via JS adding a class to container, or just CSS: */
.board-pile-slot:hover .pile-inspector-overlay {
    display: block;
    animation: pileInspectorFadeIn 0.2s ease-out;
}

@keyframes pileInspectorFadeIn {
    from { opacity: 0; transform: translateX(-50%) translateY(10px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
}

/* The cards inside the inspector */
.inspector-card {
    position: absolute;
    bottom: 10px;
    left: 50%; /* Center origin */
    width: 100px;
    height: 140px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    
    /* Content alignment */
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    font-weight: bold;
    color: var(--text);
    text-align: center;
    
    /* Transform origin at bottom center for fanning */
    transform-origin: center 200%; 
    transition: transform 0.1s cubic-bezier(0.1, 0.7, 1.0, 0.1);
    
    will-change: transform;
}

.inspector-card.is-center {
    z-index: 10;
    border-color: var(--primary);
    box-shadow: 0 0 15px var(--primary-ring);
}

/* Optional: Back style for inspector items */
.inspector-card[data-is-back="true"] {
    background: repeating-linear-gradient(45deg, #444, #444 10px, #555 10px, #555 20px);
    color: transparent;
}
.inspector-card[data-is-back="true"]::after {
    content: ''; /* No text needed for mini view */
}

/* Progress Bar / Indicator (Optional) */
.inspector-progress {
    position: absolute;
    bottom: -10px;
    left: 10px;
    right: 10px;
    height: 4px;
    background: rgba(0,0,0,0.2);
    border-radius: 2px;
}
.inspector-progress-bar {
    height: 100%;
    background: var(--primary);
    border-radius: 2px;
    width: 0%;
}

.area-spread {
    /* 平铺模式：默认 flex */
    flex-wrap: nowrap !important;
    overflow-x: visible;
    overflow-y: visible; 
    gap: 0 !important;
    align-items: flex-start;
    min-width: 0; /* 防止撑开父容器 */
    max-width: 100%;
}

.area-spread .card-placeholder {
    flex-shrink: 0;
    transition: margin-left 0.1s ease-out; /* 快速响应 */
    margin-left: var(--dynamic-card-margin, 10px);
}
.area-spread .card-placeholder:first-child {
    margin-left: 0 !important;
}

.card-placeholder {
    width: 100px;
    height: 140px;
    flex: 0 0 100px; 
    background: linear-gradient(135deg, var(--surface) 0%, var(--bg-end) 100%);
    border: 1px solid var(--border);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 2px 5px var(--shadow-1);
    transition: transform 0.2s, box-shadow 0.2s;
    font-size: 0.9rem;
    color: var(--text);
    font-weight: 500;
    user-select: none;
    position: relative;
    touch-action: none;
    text-align: center; /* Center multi-line text */
    padding: 4px; /* Internal padding */
}

/* Drag Interaction Styles */
.card-placeholder.press-active {
    transform: scale(0.92);
    /* Keep color consistent, visual feedback via border/shadow */
    background: var(--surface);
    box-shadow: 0 0 10px var(--primary-ring);
}

.card-placeholder.dragging-source {
    opacity: 0.6; /* More visible (was 0.2) */
    filter: grayscale(50%); /* Less gray */
    border: 2px dashed var(--border);
}

.drag-ghost {
    background: var(--surface);
    border: 2px solid var(--primary-1);
    box-shadow: 0 20px 40px rgba(0,0,0,0.5);
    /* Initial state for physics loop */
    z-index: 10000;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    opacity: 0.95;
    font-size: 0.9rem;
    color: var(--text);
    background: linear-gradient(135deg, var(--surface) 0%, var(--bg-end) 100%);
}

/* Drag Over Animation for Drop Zones */
[data-drop-zone].drag-over {
    background-color: rgba(var(--primary-rgb), 0.15) !important; /* Force override */
    border-color: var(--primary-1) !important;
    border-style: solid;
    box-shadow: inset 0 0 20px rgba(var(--primary-rgb), 0.2);
    transform: scale(1.01);
    transition: all 0.2s ease;
}

.treatment-area-wrappper {
    margin-bottom: 20px;
}

/* Redefine specific style if specific spacing is needed, 
   but logic suggests 'treatment-container' is already styled by unified block. 
   Just ensure no conflicting overrides exist. */

.drop-pulse {
    animation: dropPulse 0.5s ease-out;
}

@keyframes dropPulse {
    0% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7); border-color: #4CAF50; }
    70% { box-shadow: 0 0 0 10px rgba(76, 175, 80, 0); border-color: #4CAF50; }
    100% { box-shadow: 0 0 0 0 rgba(76, 175, 80, 0); }
}

.card-placeholder:hover {
    /* transform: translateY(-5px); Removed hover lift animation */
    box-shadow: 0 8px 15px var(--shadow-2);
    z-index: 1;
    border-color: var(--primary-1);
}

/* Role List Panel */
.role-list-panel {
    flex: 1;
    background: var(--surface);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px var(--shadow-1);
    border: 1px solid var(--border);
    min-width: 250px;
}

.role-list-panel h4 {
    margin-top: 0;
    margin-bottom: 15px;
    color: var(--text-muted);
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 2px solid var(--border);
    padding-bottom: 10px;
}

.role-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.role-summary {
    padding: 12px 15px;
    border-radius: 8px;
    background-color: var(--surface);
    border: 1px solid var(--border);
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: var(--text);
}

.role-summary:hover {
    background-color: var(--bg-start);
    border-color: var(--text-subtle);
}

.role-summary.active {
    background-color: var(--token-accent-blue);
    border-color: var(--primary-2);
    color: var(--text-active);
    font-weight: 600;
    box-shadow: 0 2px 4px var(--primary-ring);
}

.role-summary .player-name {
    font-size: 0.95rem;
}

.role-summary .player-hp {
    font-size: 0.85rem;
    color: var(--danger);
    background: rgba(245, 101, 101, 0.1);
    padding: 2px 8px;
    border-radius: 10px;
}

/* Utilities */
.hidden {
    display: none !important;
}

/* Responsive */
@media (max-width: 768px) {
    .game-main-area {
        flex-direction: column;
    }
    
    .role-list-panel {
        width: 100%;
    }
    
    .character-info {
        flex-direction: column;
        text-align: center;
    }
}

/* Game Board Panel (Central/Public Area) */
.game-board-panel {
    background: transparent;
    border: none;
    border-radius: 0;
    padding: 0;
    box-shadow: none;
    /* Ensure auto margin from previous fix is preserved if defined in inline style, 
       but here we keep margin-bottom if needed for spacing, though inline style 'auto' takes precedence */
    margin-bottom: 20px; 
}

.game-board-panel h3 {
    margin-top: 0;
    color: var(--text-muted);
    font-size: 1.1rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    border-bottom: 2px solid var(--border);
    padding-bottom: 10px;
    margin-bottom: 15px;
}

/* Specific override for treatment container */
.treatment-container {
    background-color: transparent !important;
    border: none !important;
    box-shadow: none !important;
    /* justify-content: center;  Moved to .area-centered class */
    /* Critical: allow clicks to pass through the empty container space to the watermark below */
    pointer-events: none; 
}

/* Ensure cards inside the treatment container are still interactive */
.treatment-container > * {
    pointer-events: auto;
}

/* Fix: Allow dropping cards into treatment container when dragging */
body.is-global-dragging .treatment-container {
    pointer-events: auto !important;
}

/* Hand Area Text Click-Through Fix */
#hand-cards-container {
    pointer-events: none; /* Allow clicks to pass through empty space to watermark */
}
#hand-cards-container > * {
    pointer-events: auto; /* Cards remain interactive */
}
body.is-global-dragging #hand-cards-container {
    pointer-events: auto !important; /* Allow dropping during drag */
}



/* Drag & Drop Real Movement Styles */
.dragging-real {
    box-shadow: 0 15px 30px rgba(0,0,0,0.3) !important;
    opacity: 0.95;
    pointer-events: none; /* Crucial for elementFromPoint */
    cursor: grabbing;
    will-change: transform, left, top;
}

.drag-placeholder {
    opacity: 0;
    visibility: hidden;
    box-shadow: none !important;
    background: transparent !important;
    /* border: 2px dashed rgba(0,0,0,0.1);  Width mismatch fix: Border was adding width/height causing jump on drop */
    border: none;
}

.drop-pulse {
    animation: pulseHighlight 0.5s ease-out;
}

@keyframes pulseHighlight {
    0% { background-color: rgba(72, 187, 120, 0.2); }
    100% { background-color: transparent; }
}

/* =========================================
   Speed Control Slider Styling
   ========================================= */
.speed-control-group {
    display: inline-flex;
    align-items: center;
    margin-left: 15px;
    padding: 6px 14px;
    background: rgba(0, 0, 0, 0.03);
    border-radius: 20px;
    border: 1px solid var(--border);
    transition: all 0.3s ease;
}

[data-theme='dark'] .speed-control-group {
    background: rgba(255, 255, 255, 0.05);
}

.speed-control-group:hover {
    background: var(--surface);
    border-color: var(--primary-2);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.speed-icon {
    font-size: 1.1rem;
    margin-right: 12px;
    opacity: 0.6;
    filter: grayscale(100%);
    transition: all 0.3s ease;
    cursor: default;
}

.speed-control-group:hover .speed-icon {
    filter: none;
    opacity: 1;
    transform: scale(1.1);
}

/* Range Input Reset */
#game-speed-range {
    -webkit-appearance: none;
    width: 140px;
    background: transparent;
    margin: 0;
    cursor: pointer;
}

#game-speed-range:focus {
    outline: none;
}

/* Webkit (Chrome, Safari, Edge) Track */
#game-speed-range::-webkit-slider-runnable-track {
    width: 100%;
    height: 6px;
    cursor: pointer;
    background: var(--border);
    border-radius: 3px;
    transition: background 0.3s;
}

#game-speed-range:hover::-webkit-slider-runnable-track {
    background: #cbd5e0;
}
[data-theme='dark'] #game-speed-range:hover::-webkit-slider-runnable-track {
    background: #4a5568;
}

/* Webkit Thumb */
#game-speed-range::-webkit-slider-thumb {
    height: 18px;
    width: 18px;
    border-radius: 50%;
    background: var(--primary-2);
    cursor: pointer;
    -webkit-appearance: none;
    margin-top: -6px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    border: 2px solid var(--surface);
    transition: transform 0.1s, background 0.3s, box-shadow 0.3s;
}

#game-speed-range:hover::-webkit-slider-thumb {
    transform: scale(1.15);
    background: var(--primary-1);
    box-shadow: 0 0 0 4px var(--primary-ring);
}

#game-speed-range:active::-webkit-slider-thumb {
    transform: scale(0.95);
    background: var(--primary-3);
}

/* Firefox Track */
#game-speed-range::-moz-range-track {
    width: 100%;
    height: 6px;
    cursor: pointer;
    background: var(--border);
    border-radius: 3px;
    transition: background 0.3s;
}

/* Firefox Thumb */
#game-speed-range::-moz-range-thumb {
    height: 18px;
    width: 18px;
    border: 2px solid var(--surface);
    border-radius: 50%;
    background: var(--primary-2);
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: transform 0.1s, box-shadow 0.3s;
}

#game-speed-range:hover::-moz-range-thumb {
    transform: scale(1.15);
    box-shadow: 0 0 0 4px var(--primary-ring);
}

/* Value Display */
.speed-val {
    margin-left: 12px;
    font-size: 0.9rem;
    font-weight: 600;
    font-family: 'Consolas', 'Monaco', monospace;
    color: var(--text-muted);
    min-width: 55px;
    text-align: right;
    user-select: none;
}
@media (max-width: 1024px) {
    .game-container {
        flex-direction: column;
    }
    .game-layout-sidebar {
        width: 100%;
        order: -1;
    }
    .game-log-panel {
        flex-direction: row;
        justify-content: space-between;
    }
}
@media (max-width: 1024px) {
    .game-top-section {
        flex-direction: column;
    }
    .game-layout-sidebar {
        width: 100%;
        order: -1;
    }
    .game-log-panel {
        flex-direction: row;
        justify-content: space-between;
    }
    .main-perspective-container {
        flex-direction: column;
    }
}
.game-bottom-section {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 100%;
    flex-shrink: 0; /* Prevent shrinking when top section expands */
    padding-top: 5px; /* Optional visual separation */
    /* Add padding to prevent overlap with footer */
    padding-bottom: 20px; 
    /* Force margin at bottom to push away from container edge */
    margin-bottom: 20px;
}
.game-table-panel {
    width: 100%;
    min-height: 120px;
    background: rgba(0, 0, 0, 0.2); 
    border-bottom: 1px solid var(--border);
    /* Make this panel fill the available vertical space in its parent (.game-layout-main) */
    flex: 1;
    display: flex; /* Activate flex to allow children (table-layout-grid) to fill height */
    flex-direction: column;
}
.role-table-layout {
    display: flex;
    flex-direction: row;
    gap: 15px;
    overflow-x: auto;
    padding: 10px 0;
    align-items: flex-start;
}
.role-summary {
    min-width: 120px;
    padding: 10px;
    background: var(--bg-panel);
    border: 1px solid var(--border);
    border-radius: 4px;
    display: flex;
    flex-direction: column;
    gap: 5px;
    align-items: center;
}
.role-summary.active {
    border-color: var(--primary);
    box-shadow: 0 0 8px var(--primary-shadow);
}
.role-table-layout {
    flex-direction: row-reverse;
    justify-content: space-around;
}
.table-layout-grid {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    /* Use stretch to ensure all columns share the full height */
    align-items: stretch; 
    width: 100%;
    min-height: 100%; 
    flex: 1;
    gap: 15px;
}

.table-side-col {
    display: flex;
    flex-direction: column;
    /* Vertically center the role list within the full-height column */
    justify-content: center; 
    min-width: 140px;
    padding-top: 0; 
}

.table-center-col {
    display: flex;
    flex-direction: column;
    flex: 1;
    min-width: 0; /* 关键：允许内容区域收缩，触发 JS 动态折叠 */
    align-items: center;
    /* Start from top to keep role-list-top at the top */
    justify-content: flex-start;
    min-height: 100%;
}

/* Ensure the treatment area centers itself in the remaining space below the top roles */
#game-board-panel {
    margin-top: auto !important;
    margin-bottom: auto !important;
}

.role-column {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: center;
}

.role-row {
    display: flex;
    flex-direction: row-reverse;
    gap: 10px;
    justify-content: space-around;
    width: 100%;
    flex-wrap: wrap;
}
.current-character-panel {
    flex-direction: row;
    align-items: center;
}

.character-info {
    width: auto;
    min-width: 286px;
    flex-shrink: 0;
    border-bottom: none;
    border-left: 1px solid var(--border);
    padding-bottom: 0;
    padding-left: 20px;
    padding-right: 20px;
}

.char-details h3 {
    white-space: nowrap;
}

.player-hand {
    flex: 1;
    padding-right: 20px;
    min-width: 0; /* Fixes flex item expansion issue for overlap logic */
}
.area-watermark {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 0;
    font-size: 2.5rem;
    font-weight: 900;
    color: var(--text);
    opacity: 0.1; /* Slightly increased visibility */
    /* Allow interaction with the watermark text */
    pointer-events: auto;
    white-space: nowrap;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    width: 100%;
    text-align: center;
    cursor: pointer; /* Show pointer to indicate clickability */
}

.cards-container {
    position: relative;
    z-index: 1;
    min-height: 140px; /* Ensure height for watermark */
}
/* override removed to keep watermark behind cards */
.drag-ghost {
    background: var(--surface);

}
/* Card Back Styling */
.card-placeholder[data-card-key='CardBack'] {
    background: repeating-linear-gradient(
        45deg,
        #444,
        #444 10px,
        #555 10px,
        #555 20px
    );
    color: transparent !important;
    text-shadow: none !important;
    border: 1px solid #777;
    /* position: relative;  <-- REMOVED: potentially conflicts with absolute positioning in stacks */
    /* Flex items formed by cards are usually containing blocks anyway, or we ensure they have some transform */
}

/* Ensure CardBacks in Stacked/Deck slots stay absolute centered */
.area-stacked > .card-placeholder[data-card-key='CardBack'] {
    position: absolute !important;
}

/* Ensure CardBacks in Spread/Hand slots can contain their absolute ::after children */
.area-spread > .card-placeholder[data-card-key='CardBack'],
.player-hand .card-placeholder[data-card-key='CardBack'] {
    position: relative;
}

.card-placeholder[data-card-key='CardBack']::after {
    content: 'BACK';
    font-size: 0.8em;
    font-weight: bold;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 2em;
    color: rgba(255,255,255,0.2);
}

